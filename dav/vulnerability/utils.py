"""Utility functions for vulnerability management."""

from typing import Dict, Any, List


def extract_severity_from_cve(cve: Dict[str, Any]) -> str:
    """Extract severity from CVE data."""
    metrics = cve.get("metrics", {})
    
    # Try CVSS v3.1 first
    if "cvssMetricV31" in metrics and metrics["cvssMetricV31"]:
        return metrics["cvssMetricV31"][0].get("cvssData", {}).get("baseSeverity", "UNKNOWN")
    
    # Try CVSS v3.0
    if "cvssMetricV30" in metrics and metrics["cvssMetricV30"]:
        return metrics["cvssMetricV30"][0].get("cvssData", {}).get("baseSeverity", "UNKNOWN")
    
    # Try CVSS v2
    if "cvssMetricV2" in metrics and metrics["cvssMetricV2"]:
        return metrics["cvssMetricV2"][0].get("baseSeverity", "UNKNOWN")
    
    return "UNKNOWN"


def extract_cvss_score_from_cve(cve: Dict[str, Any]) -> float:
    """Extract CVSS score from CVE data."""
    metrics = cve.get("metrics", {})
    
    # Try CVSS v3.1 first
    if "cvssMetricV31" in metrics and metrics["cvssMetricV31"]:
        score = metrics["cvssMetricV31"][0].get("cvssData", {}).get("baseScore", 0)
        if score:
            return float(score)
    
    # Try CVSS v3.0
    if "cvssMetricV30" in metrics and metrics["cvssMetricV30"]:
        score = metrics["cvssMetricV30"][0].get("cvssData", {}).get("baseScore", 0)
        if score:
            return float(score)
    
    # Try CVSS v2
    if "cvssMetricV2" in metrics and metrics["cvssMetricV2"]:
        score = metrics["cvssMetricV2"][0].get("cvssData", {}).get("baseScore", 0)
        if score:
            return float(score)
    
    return 0.0


def extract_description_from_cve(cve: Dict[str, Any]) -> str:
    """Extract CVE description."""
    descriptions = cve.get("descriptions", [])
    for desc in descriptions:
        if desc.get("lang") == "en":
            return desc.get("value", "")
    return "No description available"


def extract_references_from_cve(cve: Dict[str, Any]) -> List[str]:
    """Extract reference URLs from CVE."""
    references = cve.get("references", [])
    return [ref.get("url", "") for ref in references if ref.get("url")]
